<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Iscrizione – Marcia Demo</title>
  <style>
    body{font-family:Arial, sans-serif;margin:0;background:#f4f4f4;}
    header{background:#111;color:#fff;padding:18px;text-align:center;}
    main{max-width:700px;margin:24px auto;background:#fff;padding:20px;border-radius:12px;}
    label{display:block;margin-top:12px;font-weight:700;}
    input, select{width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;margin-top:6px;}
    .row{display:flex;gap:10px;flex-wrap:wrap;}
    .row > div{flex:1;min-width:220px;}
    .check{display:flex;gap:10px;align-items:flex-start;margin-top:12px;}
    .check input{width:auto;margin-top:3px;}
    button{margin-top:16px;padding:12px 18px;background:#fc4c02;color:#fff;border:none;border-radius:8px;cursor:pointer;font-size:16px;}
    small{color:#666;}
    a{color:#111;}
    .box{background:#fafafa;border:1px solid #eee;border-radius:10px;padding:14px;margin-top:12px;}
  </style>
</head>
<body>
<header>
  <h1>Iscrizione – Marcia Demo</h1>
  <p><small>Registrazione semplice (MVP)</small></p>
</header>

<main>
  <p><a href="evento.html">← Torna all’evento</a></p>

  <div class="box">
    <b>Nota:</b> in questa fase salviamo i dati “in demo” (non in database).
    Nel prossimo step li memorizziamo e li colleghiamo a Strava.
  </div>

  <form onsubmit="return handleSubmit(event)">
    <label>Nickname evento (opzionale)</label>
    <input id="nickname" placeholder="Es. Lucio_Gravel" />

    <div class="row">
      <div>
        <label>Anno di nascita *</label>
        <input id="birthyear" type="number" min="1900" max="2026" required placeholder="Es. 1990"/>
      </div>
      <div>
        <label>Sesso</label>
        <select id="gender">
          <option value="M">Maschile</option>
          <option value="F">Femminile</option>
          <option value="NA">Preferisco non indicarlo</option>
        </select>
      </div>
    </div>

    <div class="check">
      <input id="terms" type="checkbox" required />
      <small>Accetto regolamento e privacy. (Soluzione amatoriale, non cronometraggio ufficiale)</small>
    </div>

    <div class="check">
      <input id="consentName" type="checkbox" />
      <small>Consento la pubblicazione del mio nome/nickname in classifica pubblica.</small>
    </div>

    <button type="submit">Iscrivimi (demo)</button>
  </form>

  <div id="result" class="box" style="display:none;"></div>

  <script>
    function ageGroup(age){
      if(age <= 20) return "U20";
      if(age <= 30) return "21–30";
      if(age <= 40) return "31–40";
      if(age <= 50) return "41–50";
      return "51+";
    }

    function handleSubmit(e){
      e.preventDefault();
      const nickname = document.getElementById("nickname").value.trim();
      const by = parseInt(document.getElementById("birthyear").value, 10);
      const gender = document.getElementById("gender").value;
      const consent = document.getElementById("consentName").checked;

      const eventYear = 2026; // demo
      const age = eventYear - by;
      const group = ageGroup(age);

      // "Salvataggio" demo: localStorage
      const payload = {
        nickname: nickname || null,
        birthyear: by,
        age,
        age_group: group,
        gender,
        consent_public_name: consent,
        created_at: new Date().toISOString()
      };
      localStorage.setItem("marce_demo_registration", JSON.stringify(payload));

      const box = document.getElementById("result");
      box.style.display = "block";
      box.innerHTML = `
        <h3>Iscrizione completata (demo)</h3>
        <p><b>Categoria:</b> ${gender === "NA" ? "—" : gender} ${group}<br>
           <b>Età calcolata:</b> ${age}<br>
           <b>Nickname:</b> ${payload.nickname || "(non indicato)"}<br>
           <b>Consenso nome pubblico:</b> ${consent ? "Sì" : "No"}</p>
        <p><b>Prossimo step:</b> “Connetti Strava” (fase 2).</p>
        <p><a href="classifica.html">Vai alla classifica demo →</a></p>
      `;
      return false;
    }
  </script>
</main>
</body>
</html>
